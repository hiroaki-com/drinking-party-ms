{% extends "base.html" %}

{% block title %}Party Detail{% endblock %}    

{% block content %}
<div class="col">
  <div class="card-body">
    <p class="card-text">
      <div class='mb-1' style='text-align: left;'>{{ object.title }}</div>
      開催日時 :<br>
        <u>{{ object.date }} {{ object.time }}</u> ~<br>
        <br>
        店舗 : {{ object.restaurant }}<br>
        場所 : {{ object.address }}<br>
        URL : <a href="{{ object.url }}" target="_blank" rel="noopener noreferrer">{{ object.url }}<i class="fa-solid fa-up-right-from-square fa-xs"></i></a>
        <div class="aa" style='font-family: Font Awesome 5 Free;'></div>
        予約者 : {{ object.subscriber }}<br>
        予算 : {{ object.fee }}円<br>
        備考 : {{ object.comment }}<br>
        作成者 : {{ object.user }}<br>
      <!-- 参加ボタン -->
      <div class="card-footer">
        {% if is_user_joined_for_party %}
        <button type="button" id="ajax-join_for_party" style="border:none;background:none">
          <i class="fas fa-heart text-danger" id="join_for_party-icon"></i>
        </button>
        {% else %}
        <button type="button" id="ajax-join_for_party" style="border:none;background:none">
          <i class="far fa-heart text-danger" id="join_for_party-icon"></i>
        </button>
        {% endif %}
        <span id="join_for_party-count">{{ join_for_party_count }}</span>
        <span>件の参加</span>
      </div>
      <!-- 参加ボタン -->
      <div class='mt-3' style='font-size: 8px'>作成日 : {{ object.create_dt }}</div><div style='font-size: 8px'>更新日 : {{ object.mod_dt }}</div><br>
      <div class="detail">
        <a href="{% url 'party:index'%}">HOME</a>
      </div>
    </p>
  </div>
</div>

{% block extrajs %}
<script type="text/javascript">
  /* 飲み会への参加 */
  document.getElementById('ajax-join_for_party').addEventListener('click', e => {
    e.preventDefault();
    const url = '{% url "party:join_for_party" %}';
    fetch(url, {
      method: 'POST',
      body: `party_pk={{ party.pk }}`,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8',
        'X-CSRFToken': '{{ csrf_token }}',
      },
    }).then(response => {
      return response.json();
    }).then(response => {
      // 参加数を書き換える
      const counter = document.getElementById('join_for_party-count')
      counter.textContent = response.join_for_party_count
      const icon = document.getElementById('join_for_party-icon')
      // 作成した場合はハートを塗る
      if (response.method == 'create') {
        icon.classList.remove('far')
        icon.classList.add('fas')
        icon.id = 'join_for_party-icon'
      } else {
        icon.classList.remove('fas')
        icon.classList.add('far')
        icon.id = 'join_for_party-icon'
      }
    }).catch(error => {
      console.log(error);
    });
  });
</script>
{% endblock %}

{% endblock %}